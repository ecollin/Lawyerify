<!DOCTYPE html>
<html>
    <!-- Tinymce text editor -->
    <script src="//cdn.tinymce.com/4/tinymce.min.js"></script>
    <script>
      tinymce.init({ 
        selector:"textarea",
        height: 350,
        toolbar: "insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image | print preview media fullpage | forecolor backcolor emoticons | sizeselect | fontselect | fontsizeselect ",
        //the following adds two em spaces when tab is pressed and prevents default (effectively indents).
        setup: function(ed) {
          ed.on('keydown', function(event) {
            if (event.keyCode == 9) { // tab pressed
              ed.execCommand('mceInsertContent', false, '&emsp;&emsp;');
              event.preventDefault();
            }
          });
        }
      });
    </script>

    <!-- HTML5shiv below. Probably totally unnecessary because like 10 people will ever see this site.-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js"></script>

  <head>
    <title>Lawyerifyâ€”Replace all words with longers synonyms </title>
    <meta name="description" content="Replace each word in text with its longest character synonym"/>
    <meta name="keywords" content="Lawyerify, synonyms, longer essay, how to make essay longer, thesaurus"/>
    <meta name="author" content="Enrique Collin"/>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="style.css" type ="text/css"/>
  </head>
  <body>
  <header>
    <h1>Lawyerify </h1>
    <p id="subtitle" style="margin:0px"><strong>Replace all words with their longest synonyms</strong></p>
  </header>
  <div id="main">
    <textArea id="area"></textArea>
    <button id="lawyerify">Lawyerify</button>
  </div>
  <footer>
      <p id="copyright"> No copyright. Is this <em> really </em> worth stealing though?</p>
  </footer>
  </body>
</html>

<script>
var setWords = {}; //common words the algorithm below shouldn't replace because it does a bad job.
setWords["he"] = "he"; setWords["He"] = "He"; setWords["a"] = "a"; setWords["A"] = "A";
var text = "";
var button = document.querySelector("#lawyerify");
button.addEventListener("click", function(event) {
  text = tinyMCE.get("area").getContent({format: "text"});
  var wordRegex = /\b[a-z]+'?[a-z]*\b/gi; 
  var matches = text.match(wordRegex);
  matches.forEach(function(word,i) {
    if (word.includes("\'")) return;
    var url = "https://words.bighugelabs.com/api/2/d114c68208c8b398bc59a8963d564320/" + word + "/json";
    var req = new XMLHttpRequest();
    req.open("GET",url, true);
    req.addEventListener("load", function(event) {
      if (req.status == 200)
        if (i == matches.length - 1)
          process(JSON.parse(req.responseText), word, true);
        else
          process(JSON.parse(req.responseText), word, false);
      else if (req.status == 404) return; //word not found, simply ignore it.
      else if (req.status == 500) throw new Error("Number of synonym requests per day reached. No more words can be lawyerified.");
    });
    req.send();
  });
});
//Note: because this is being called by the API (JSONP format), it needs to be global function.
  function process(result, word, last) {
    var count = 0; //# of parts of speech possible for the word
    var pos;  //Part of speech
    for ( var prop in result) {
      if (prop == "noun") {
        pos = "noun";
        count++;
      } else if (prop == "verb") {
        pos = "verb";
        count++;
      } else if (prop == "adjective") {
        pos = "adjective";
        count++;
       } else if (prop == "adverb") {
        pos = "adverb";
        count++;
       }
   }
   if (count > 1) {
     if (last)
        tinyMCE.get("area").setContent(text, {format:"text"});
     return; //don't do anything w/ more than one possible PoS
   }
   var synonyms = result[pos]["syn"]; //this is an array of synonyms.
   var longest = word;
   synonyms.forEach(function(syn) {
     if (syn.length > longest.length) longest = syn;   
   });
   if (setWords.hasOwnProperty(word)) longest = setWords[word]; //if the word is a prop of setWords, assign value from there.
   var upper = capitalize(word);
   var lower = decapitalize(word);
   var replaced = new RegExp(upper, "g");
   text = text.replace(replaced, capitalize(longest));
   replaced = new RegExp(lower, "g");
   text = text.replace(replaced, decapitalize(longest));
   function capitalize(word) {
       return word.charAt(0).toUpperCase() + word.slice(1);
   }
   function decapitalize(word) {
       return word.charAt(0).toLowerCase() + word.slice(1);
   }
    if (last)
        tinyMCE.get("area").setContent(text, {format:"text"});
   
  }
</script>
